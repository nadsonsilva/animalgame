name: CI Workflow

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest  # Configuração para rodar em Ubuntu

    steps:
    # Passo 1: Check out o código do repositório
    - name: Checkout code
      uses: actions/checkout@v2

    # Passo 2: Configurar Node.js para Angular
    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '14'

    # Passo 3: Instalar dependências do Angular
    - name: Install Angular dependencies
      run: |
        cd frontend  # Navega até o diretório do frontend
        npm install  # Instala as dependências

    # Passo 4: Rodar os testes do Angular
    - name: Run Angular tests
      run: |
        cd frontend  # Navega até o diretório do frontend
        npm test -- --watch=false --browsers=ChromeHeadless  # Executa os testes

    # Passo 5: Configurar JDK 17
    - name: Set up JDK 17
      uses: actions/setup-java@v2
      with:
        java-version: '17'  # Versão correta do JDK
        distribution: 'zulu'  # Usando a distribuição Zulu (opcional)

    # Passo 6: Instalar dependências do Spring Boot (usando Gradle)
    - name: Install Spring Boot dependencies
      run: |
        cd backend  # Navega até o diretório do backend
        ./gradlew build --no-daemon  # Instala as dependências do Spring Boot e compila o projeto

    # Passo 7: Rodar os testes do Spring Boot (usando Gradle)
    - name: Run Spring Boot tests
      run: |
        cd backend  # Navega até o diretório do backend
        ./gradlew test --no-daemon  # Executa os testes do Spring Boot