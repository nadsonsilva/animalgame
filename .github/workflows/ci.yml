name: CI Workflow

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest  # Configuração para rodar em Ubuntu

    steps:
    # Passo 1: Check out o código do repositório
    - name: Checkout code
      uses: actions/checkout@v2

    # Passo 2: Configurar Node.js para Angular
    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '14'

    # Passo 3: Instalar dependências do Angular
    - name: Install Angular dependencies
      run: |
        cd frontend  # Navega até o diretório do frontend
        npm install  # Instala as dependências

    # Passo 4: Rodar os testes do Angular
    - name: Run Angular tests
      run: |
        cd frontend  # Navega até o diretório do frontend
        npm test -- --watch=false --browsers=ChromeHeadless  # Executa os testes

    # Passo 5: Configurar JDK para o Spring Boot
    - name: Set up JDK 11
      uses: actions/setup-java@v2
      with:
        java-version: '11'  # Configura o JDK 11 necessário para Spring Boot

    # Passo 6: Instalar dependências do Spring Boot
    - name: Install Spring Boot dependencies
      run: |
        cd backend  # Navega até o diretório do backend
        ./mvnw install  # Instala as dependências do Spring Boot

    # Passo 7: Rodar os testes do Spring Boot
    - name: Run Spring Boot tests
      run: |
        cd backend  # Navega até o diretório do backend
        ./mvnw test  # Executa os testes